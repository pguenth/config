# XONSH WEBCONFIG START
$PROMPT = '{env_name}{BOLD_GREEN}{user}@{hostname}{BOLD_BLUE} {cwd}{branch_color}{gitstatus: {}}{RESET} {BOLD_BLUE}{prompt_end}{RESET} '
$XONSH_COLOR_STYLE = 'native'
# XONSH WEBCONFIG END

#if $TILIX_ID or $VTE_VERSION:
#    source-bash /etc/profile.d/vte.sh

# map caps to escape for vim
# now done in xinitrc/xsession
# setxkbmap -option caps:escape
from math import *
import numpy as np

def _ranger_cd(path=None):
    temp_file = $(mktemp -t "ranger_cd.XXXXXXXX").strip()
    path = path if not path is None else $PWD
    ranger --choosedir=@(temp_file) -- @(path)
    chosen_dir = $(cat -- @(temp_file))
    if not chosen_dir == "" and chosen_dir != $PWD:
        cd @(chosen_dir)
    rm -f -- @(temp_file)

def _treetasks_safe():
    cp /home/patrick/.treetasks.xml /home/patrick/.treetasks.xml.backup
    python /home/patrick/treetasks/treetasks.py

def _unified_cat_single(path=None):
    if path is None:
        return

    ftype = $(stat -c '%F' @(path))
    if ftype == 'directory\n':
        width = int($(stty size).split()[1])
        spacer = 'â”€'
        title = spacer * 3 + ' ls -la ' + path + ' '
        print(title + spacer * (width - len(title)))
        ls -la @(path)
        print(spacer * width)
    else:
        bat @(path)

def _unified_cat(paths):
    for p in paths:
        _unified_cat_single(p)
    

aliases['r'] = _ranger_cd
aliases['uc'] = _unified_cat
aliases['tudu'] = 'xonsh ~/tudu-wrapper.xsh'
aliases['tt'] = _treetasks_safe
aliases['sharevnc2'] = 'bash -c "export DISPLAY=:0; x0vncserver -rfbauth ~/.vnc/passwd -rfbport 5902"'
aliases['sharevnc'] = 'x11vnc -display :0'
aliases['setfbres'] = lambda args: $(xrandr --fb @(str(args[0]) + 'x' + str(args[1])))
aliases['sshkeycheck'] = lambda args: $(cat @($HOME + "/.ssh/known_hosts") | grep @(args[0]) | ssh-keygen -lf -)
aliases['sshkeyshow'] = lambda args: $(ssh -o VisualHostKey=yes -fN @(args[0]))
